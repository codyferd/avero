<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Morris</title>
    <script src="../lib/vue.js"></script>
    <script src="../lib/tailwind.js"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; overflow: hidden; }
        .game-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            aspect-ratio: 1 / 1;
            width: 100%;
            max-width: 500px;
            position: relative;
        }
        .piece-shadow { box-shadow: 0 4px 0 rgba(0,0,0,0.4); }
        .slot-hover:hover { background-color: rgba(255, 255, 255, 0.15); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-5xl flex flex-col md:flex-row gap-12 items-center justify-center relative">

        <transition name="fade">
            <div v-if="winner" class="absolute inset-0 z-50 flex items-center justify-center bg-slate-950/90 backdrop-blur-sm rounded-3xl">
                <div class="text-center p-10 border-2 rounded-2xl shadow-2xl" :class="winner === 1 ? 'border-rose-500' : 'border-cyan-500'">
                    <h2 class="text-6xl font-black mb-4 italic" :class="winner === 1 ? 'text-rose-500' : 'text-cyan-500'">
                        PLAYER {{ winner }} WINS!
                    </h2>
                    <p class="text-slate-400 mb-8">Victory is yours. The opponent has been cleared.</p>
                    <button @click="resetGame" class="px-8 py-3 bg-white text-slate-900 font-bold rounded-full hover:bg-slate-200 transition-colors uppercase tracking-widest">
                        Rematch
                    </button>
                </div>
            </div>
        </transition>

        <div class="flex flex-col items-center w-32 order-2 md:order-1">
            <div :class="['p-4 rounded-xl mb-4 transition-all border-2 w-full text-center', turn === 1 && !winner ? 'border-rose-500 bg-rose-500/10 shadow-[0_0_15px_rgba(244,63,94,0.3)]' : 'border-slate-800 opacity-50']">
                <p class="font-bold text-rose-500">Player 1</p>
                <p class="text-[10px] uppercase tracking-tighter opacity-70">{{ p1Stock }} Left</p>
            </div>
            <div class="grid grid-cols-2 gap-2 bg-slate-900/80 p-3 rounded-lg border border-slate-700">
                <div v-for="n in (9 - p1Stock - p1OnBoard)" class="w-8 h-8 rounded-full bg-rose-950 border border-rose-500/20 flex items-center justify-center">
                    <div class="w-2 h-2 bg-rose-500/20 rounded-full"></div>
                </div>
            </div>
            <p class="text-[10px] mt-2 uppercase tracking-widest text-slate-500 font-bold">Lost</p>
        </div>

        <div class="flex flex-col items-center order-1 md:order-2">
            <div class="mb-8 text-center">
                <h1 class="text-5xl font-black tracking-tighter text-white mb-3 italic">MORRIS</h1>
                <div :class="['px-8 py-2 rounded-full font-bold transition-all duration-300 shadow-xl border',
                             phase === 'removing' ? 'bg-amber-400 text-black border-amber-200 animate-pulse' : 'bg-slate-800 text-slate-300 border-slate-700']">
                    {{ statusMessage }}
                </div>
            </div>

            <div class="game-grid bg-slate-900 p-8 rounded-3xl border border-slate-700 shadow-[0_0_50px_rgba(0,0,0,0.5)]">
                <svg class="absolute inset-0 w-full h-full p-8 pointer-events-none" viewBox="0 0 100 100">
                    <rect x="5" y="5" width="90" height="90" fill="none" stroke="#334155" stroke-width="1.2"/>
                    <rect x="20" y="20" width="60" height="60" fill="none" stroke="#334155" stroke-width="1.2"/>
                    <rect x="35" y="35" width="30" height="30" fill="none" stroke="#334155" stroke-width="1.2"/>
                    <line x1="50" y1="5" x2="50" y2="35" stroke="#334155" stroke-width="1.2"/>
                    <line x1="50" y1="65" x2="50" y2="95" stroke="#334155" stroke-width="1.2"/>
                    <line x1="5" y1="50" x2="35" y2="50" stroke="#334155" stroke-width="1.2"/>
                    <line x1="65" y1="50" x2="95" y2="50" stroke="#334155" stroke-width="1.2"/>
                </svg>

                <div v-for="(pos, idx) in points" :key="idx"
                     :style="{ gridColumn: pos.col, gridRow: pos.row }"
                     class="relative flex items-center justify-center">

                    <div @click="handleClick(idx)"
                         :class="[
                            'w-11 h-11 rounded-full cursor-pointer z-10 transition-all duration-300 flex items-center justify-center border-2',
                            board[idx] === 1 ? 'bg-rose-500 border-rose-300 piece-shadow' : '',
                            board[idx] === 2 ? 'bg-cyan-500 border-cyan-300 piece-shadow' : '',
                            !board[idx] ? 'bg-slate-800 border-slate-700 slot-hover scale-50 hover:scale-90' : '',
                            selectedPoint === idx ? 'ring-4 ring-white scale-110 z-20 shadow-[0_0_20px_white]' : ''
                         ]">
                         <div v-if="board[idx]" class="w-7 h-7 rounded-full border border-white/30"></div>
                    </div>
                </div>
            </div>

            <button @click="resetGame" class="mt-8 text-slate-500 hover:text-white transition-colors text-xs uppercase tracking-widest font-bold">
                Reset Current Game
            </button>
        </div>

        <div class="flex flex-col items-center w-32 order-3">
            <div :class="['p-4 rounded-xl mb-4 transition-all border-2 w-full text-center', turn === 2 && !winner ? 'border-cyan-500 bg-cyan-500/10 shadow-[0_0_15px_rgba(6,182,212,0.3)]' : 'border-slate-800 opacity-50']">
                <p class="font-bold text-cyan-500">Player 2</p>
                <p class="text-[10px] uppercase tracking-tighter opacity-70">{{ p2Stock }} Left</p>
            </div>
            <div class="grid grid-cols-2 gap-2 bg-slate-900/80 p-3 rounded-lg border border-slate-700">
                <div v-for="n in (9 - p2Stock - p2OnBoard)" class="w-8 h-8 rounded-full bg-cyan-950 border border-cyan-500/20 flex items-center justify-center">
                    <div class="w-2 h-2 bg-cyan-500/20 rounded-full"></div>
                </div>
            </div>
            <p class="text-[10px] mt-2 uppercase tracking-widest text-slate-500 font-bold">Lost</p>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const points = [
                    {col:1, row:1}, {col:4, row:1}, {col:7, row:1}, {col:2, row:2}, {col:4, row:2}, {col:6, row:2},
                    {col:3, row:3}, {col:4, row:3}, {col:5, row:3}, {col:1, row:4}, {col:2, row:4}, {col:3, row:4},
                    {col:5, row:4}, {col:6, row:4}, {col:7, row:4}, {col:3, row:5}, {col:4, row:5}, {col:5, row:5},
                    {col:2, row:6}, {col:4, row:6}, {col:6, row:6}, {col:1, row:7}, {col:4, row:7}, {col:7, row:7}
                ];

                const mills = [
                    [0,1,2], [3,4,5], [6,7,8], [9,10,11], [12,13,14], [15,16,17], [18,19,20], [21,22,23],
                    [0,9,21], [3,10,18], [6,11,15], [1,4,7], [16,19,22], [8,12,17], [5,13,20], [2,14,23]
                ];

                const adjacencies = {
                    0:[1,9], 1:[0,2,4], 2:[1,14], 3:[4,10], 4:[1,3,5,7], 5:[4,13], 6:[7,11], 7:[4,6,8], 8:[7,12],
                    9:[0,10,21], 10:[3,9,11,18], 11:[6,10,15], 12:[8,13,17], 13:[5,12,14,20], 14:[2,13,23],
                    15:[11,16], 16:[15,17,19], 17:[12,16], 18:[10,19], 19:[16,18,20,22], 20:[13,19], 21:[9,22], 22:[19,21,23], 23:[14,22]
                };

                const board = ref(Array(24).fill(null));
                const turn = ref(1);
                const phase = ref('placing');
                const p1Stock = ref(9);
                const p2Stock = ref(9);
                const p1OnBoard = ref(0);
                const p2OnBoard = ref(0);
                const selectedPoint = ref(null);
                const winner = ref(null);

                const statusMessage = computed(() => {
                    if (winner.value) return "GAME OVER";
                    if (phase.value === 'removing') return "MILL FORMED! DESTROY A PIECE";
                    const p = turn.value === 1 ? 'PLAYER 1' : 'PLAYER 2';
                    return `${p}: ${phase.value.toUpperCase()}`;
                });

                const isPartOfMill = (id, owner) => {
                    return mills.some(m => m.includes(id) && m.every(idx => board.value[idx] === owner));
                };

                const handleClick = (id) => {
                    if (winner.value) return;
                    const cell = board.value[id];
                    const opponent = turn.value === 1 ? 2 : 1;

                    if (phase.value === 'removing') {
                        if (cell === opponent) {
                            const opponentPieces = board.value.map((p, i) => p === opponent ? i : null).filter(x => x !== null);
                            const allInMills = opponentPieces.every(idx => isPartOfMill(idx, opponent));
                            if (allInMills || !isPartOfMill(id, opponent)) {
                                board.value[id] = null;
                                if (opponent === 1) p1OnBoard.value--; else p2OnBoard.value--;
                                finalizeTurn();
                            }
                        }
                        return;
                    }

                    if (phase.value === 'placing') {
                        if (!cell) {
                            board.value[id] = turn.value;
                            if (turn.value === 1) { p1Stock.value--; p1OnBoard.value++; }
                            else { p2Stock.value--; p2OnBoard.value++; }

                            if (isPartOfMill(id, turn.value)) phase.value = 'removing';
                            else finalizeTurn();
                        }
                    } else if (phase.value === 'moving') {
                        if (cell === turn.value) {
                            selectedPoint.value = id;
                        } else if (selectedPoint.value !== null && !cell) {
                            const count = turn.value === 1 ? p1OnBoard.value : p2OnBoard.value;
                            if (count === 3 || adjacencies[selectedPoint.value].includes(id)) {
                                board.value[selectedPoint.value] = null;
                                board.value[id] = turn.value;
                                selectedPoint.value = null;
                                if (isPartOfMill(id, turn.value)) phase.value = 'removing';
                                else finalizeTurn();
                            }
                        }
                    }
                };

                const finalizeTurn = () => {
                    if (p1Stock.value === 0 && p2Stock.value === 0) phase.value = 'moving';
                    else phase.value = 'placing';

                    turn.value = turn.value === 1 ? 2 : 1;
                    checkGameOver();
                };

                const checkGameOver = () => {
                    if (p1Stock.value === 0 && p1OnBoard.value < 3) winner.value = 2;
                    else if (p2Stock.value === 0 && p2OnBoard.value < 3) winner.value = 1;
                };

                const resetGame = () => {
                    board.value = Array(24).fill(null);
                    turn.value = 1;
                    phase.value = 'placing';
                    p1Stock.value = 9;
                    p2Stock.value = 9;
                    p1OnBoard.value = 0;
                    p2OnBoard.value = 0;
                    selectedPoint.value = null;
                    winner.value = null;
                };

                return { points, board, turn, phase, p1Stock, p2Stock, p1OnBoard, p2OnBoard, selectedPoint, statusMessage, handleClick, winner, resetGame };
            }
        }).mount('#app');
    </script>
</body>
</html>

