<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Morris</title>
    <script src="../lib/vue.js"></script>
    <script src="../lib/tailwind.js"></script>
    <style>
        body { background-color: #000000; color: #f8fafc; overflow: hidden; }
        .game-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-template-rows: repeat(7, 1fr);
            aspect-ratio: 1 / 1;
            width: 100%;
            max-width: 500px;
            position: relative;
        }
        .piece-shadow { box-shadow: 0 0 20px rgba(0,0,0,1); }
        .slot-hover:hover { background-color: rgba(255, 255, 255, 0.08); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.6s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        .p1-glow { box-shadow: 0 0 20px rgba(244, 63, 94, 0.5), inset 0 0 10px rgba(255,255,255,0.2); }
        .p2-glow { box-shadow: 0 0 20px rgba(6, 182, 212, 0.5), inset 0 0 10px rgba(255,255,255,0.2); }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-5xl flex flex-col md:flex-row gap-12 items-center justify-center relative">

        <transition name="fade">
            <div v-if="winner" class="absolute inset-0 z-50 flex flex-col items-center justify-center bg-black/95 backdrop-blur-xl rounded-3xl">
                <div class="text-center p-12 border border-white/10 rounded-3xl bg-neutral-900/50 shadow-2xl">
                    <h2 class="text-7xl font-black mb-2 italic tracking-tighter" :class="winner === 1 ? 'text-rose-500' : 'text-cyan-500'">
                        PLAYER {{ winner }}
                    </h2>
                    <p class="text-2xl font-light tracking-[0.3em] text-white mb-10 uppercase">Conqueror</p>
                    <button @click="resetGame" class="px-12 py-4 bg-white text-black font-black rounded-full hover:scale-105 active:scale-95 transition-all uppercase tracking-widest">
                        Reignite
                    </button>
                </div>
            </div>
        </transition>

        <div class="flex flex-col items-center w-32 order-2 md:order-1">
            <div :class="['p-5 rounded-2xl mb-6 transition-all border w-full text-center', turn === 1 && !winner ? 'border-rose-500/50 bg-rose-500/5 p1-glow' : 'border-white/5 opacity-20']">
                <p class="font-bold text-rose-500 uppercase text-[10px] tracking-[0.2em]">P1 Hand</p>
                <p class="text-3xl font-black text-white mt-1">{{ p1Stock }}</p>
            </div>
            <div class="grid grid-cols-2 gap-3 bg-white/5 p-4 rounded-xl border border-white/10">
                <div v-for="n in (9 - p1Stock - p1OnBoard)" class="w-8 h-8 rounded-full bg-rose-950/20 border border-rose-500/10 flex items-center justify-center">
                    <div class="w-1.5 h-1.5 bg-rose-500/20 rounded-full"></div>
                </div>
            </div>
            <p class="text-[9px] mt-3 uppercase tracking-[0.4em] text-neutral-600 font-black">Losses</p>
        </div>

        <div class="flex flex-col items-center order-1 md:order-2">
            <div class="mb-10 text-center">
                <h1 class="text-7xl font-black tracking-[calc(-0.05em)] text-white mb-4 italic">MORRIS</h1>
                <div :class="['px-12 py-2.5 rounded-full font-black transition-all duration-500 border uppercase text-[11px] tracking-[0.25em]',
                             phase === 'removing' ? 'bg-amber-400 text-black border-white animate-pulse' : 'bg-white/5 text-neutral-400 border-white/10']">
                    {{ statusMessage }}
                </div>
            </div>

            <div class="game-grid bg-neutral-950 p-10 rounded-[2.5rem] border border-white/10 shadow-[0_0_100px_rgba(0,0,0,1)]">
                <svg class="absolute inset-0 w-full h-full p-10 pointer-events-none opacity-40" viewBox="0 0 100 100">
                    <rect x="5" y="5" width="90" height="90" fill="none" stroke="white" stroke-width="0.8"/>
                    <rect x="20" y="20" width="60" height="60" fill="none" stroke="white" stroke-width="0.8"/>
                    <rect x="35" y="35" width="30" height="30" fill="none" stroke="white" stroke-width="0.8"/>
                    <line x1="50" y1="5" x2="50" y2="35" stroke="white" stroke-width="0.8"/>
                    <line x1="50" y1="65" x2="50" y2="95" stroke="white" stroke-width="0.8"/>
                    <line x1="5" y1="50" x2="35" y2="50" stroke="white" stroke-width="0.8"/>
                    <line x1="65" y1="50" x2="95" y2="50" stroke="white" stroke-width="0.8"/>
                </svg>

                <div v-for="(pos, idx) in points" :key="idx"
                     :style="{ gridColumn: pos.col, gridRow: pos.row }"
                     class="relative flex items-center justify-center">

                    <div @click="handleClick(idx)"
                         :class="[
                            'w-12 h-12 rounded-full cursor-pointer z-10 transition-all duration-300 flex items-center justify-center border',
                            board[idx] === 1 ? 'bg-rose-600 border-rose-300 p1-glow scale-100' : '',
                            board[idx] === 2 ? 'bg-cyan-600 border-cyan-300 p2-glow scale-100' : '',
                            !board[idx] ? 'bg-neutral-900 border-white/5 slot-hover scale-[0.4] hover:scale-100 hover:border-white/20' : '',
                            selectedPoint === idx ? 'ring-[6px] ring-white scale-110 z-20 shadow-[0_0_40px_white]' : ''
                         ]">
                         <div v-if="board[idx]" class="w-7 h-7 rounded-full border border-white/30 bg-gradient-to-br from-white/20 to-transparent"></div>
                    </div>
                </div>
            </div>

            <button @click="resetGame" class="mt-10 text-neutral-700 hover:text-white transition-colors text-[9px] uppercase tracking-[0.5em] font-black">
                Reset Board
            </button>

            <footer class="mt-12 text-center border-t border-white/5 pt-8 w-full">
                <p class="text-neutral-500 font-black text-[11px] uppercase tracking-[0.3em]">Luca's Website</p>
                <a href="https://sites.google.com/view/codyferd"
                   target="_blank"
                   class="text-[10px] text-neutral-600 hover:text-cyan-400 transition-all duration-300 underline underline-offset-8 mt-3 inline-block">
                   sites.google.com/view/codyferd
                </a>
            </footer>
        </div>

        <div class="flex flex-col items-center w-32 order-3">
            <div :class="['p-5 rounded-2xl mb-6 transition-all border w-full text-center', turn === 2 && !winner ? 'border-cyan-500/50 bg-cyan-500/5 p2-glow' : 'border-white/5 opacity-20']">
                <p class="font-bold text-cyan-500 uppercase text-[10px] tracking-[0.2em]">P2 Hand</p>
                <p class="text-3xl font-black text-white mt-1">{{ p2Stock }}</p>
            </div>
            <div class="grid grid-cols-2 gap-3 bg-white/5 p-4 rounded-xl border border-white/10">
                <div v-for="n in (9 - p2Stock - p2OnBoard)" class="w-8 h-8 rounded-full bg-cyan-950/20 border border-cyan-500/10 flex items-center justify-center">
                    <div class="w-1.5 h-1.5 bg-cyan-500/20 rounded-full"></div>
                </div>
            </div>
            <p class="text-[9px] mt-3 uppercase tracking-[0.4em] text-neutral-600 font-black">Losses</p>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue;

        createApp({
            setup() {
                const points = [
                    {col:1, row:1}, {col:4, row:1}, {col:7, row:1}, {col:2, row:2}, {col:4, row:2}, {col:6, row:2},
                    {col:3, row:3}, {col:4, row:3}, {col:5, row:3}, {col:1, row:4}, {col:2, row:4}, {col:3, row:4},
                    {col:5, row:4}, {col:6, row:4}, {col:7, row:4}, {col:3, row:5}, {col:4, row:5}, {col:5, row:5},
                    {col:2, row:6}, {col:4, row:6}, {col:6, row:6}, {col:1, row:7}, {col:4, row:7}, {col:7, row:7}
                ];

                const mills = [
                    [0,1,2], [3,4,5], [6,7,8], [9,10,11], [12,13,14], [15,16,17], [18,19,20], [21,22,23],
                    [0,9,21], [3,10,18], [6,11,15], [1,4,7], [16,19,22], [8,12,17], [5,13,20], [2,14,23]
                ];

                const adjacencies = {
                    0:[1,9], 1:[0,2,4], 2:[1,14], 3:[4,10], 4:[1,3,5,7], 5:[4,13], 6:[7,11], 7:[4,6,8], 8:[7,12],
                    9:[0,10,21], 10:[3,9,11,18], 11:[6,10,15], 12:[8,13,17], 13:[5,12,14,20], 14:[2,13,23],
                    15:[11,16], 16:[15,17,19], 17:[12,16], 18:[10,19], 19:[16,18,20,22], 20:[13,19], 21:[9,22], 22:[19,21,23], 23:[14,22]
                };

                const board = ref(Array(24).fill(null));
                const turn = ref(1);
                const phase = ref('placing');
                const p1Stock = ref(9);
                const p2Stock = ref(9);
                const p1OnBoard = ref(0);
                const p2OnBoard = ref(0);
                const selectedPoint = ref(null);
                const winner = ref(null);

                const statusMessage = computed(() => {
                    if (winner.value) return "END OF SESSION";
                    if (phase.value === 'removing') return "MILL: REMOVE TARGET";
                    return phase.value;
                });

                const isPartOfMill = (id, owner) => {
                    return mills.some(m => m.includes(id) && m.every(idx => board.value[idx] === owner));
                };

                const canMove = (player) => {
                    // Flying players can move unless board is full (impossible)
                    if ((player === 1 ? p1OnBoard.value : p2OnBoard.value) === 3 && phase.value !== 'placing') return true;

                    // Check every piece of the player for at least one adjacent empty slot
                    return board.value.some((cell, idx) => {
                        if (cell !== player) return false;
                        return adjacencies[idx].some(adjIdx => board.value[adjIdx] === null);
                    });
                };

                const handleClick = (id) => {
                    if (winner.value) return;
                    const cell = board.value[id];
                    const opponent = turn.value === 1 ? 2 : 1;

                    if (phase.value === 'removing') {
                        if (cell === opponent) {
                            const opponentPieces = board.value.map((p, i) => p === opponent ? i : null).filter(x => x !== null);
                            const allInMills = opponentPieces.every(idx => isPartOfMill(idx, opponent));
                            if (allInMills || !isPartOfMill(id, opponent)) {
                                board.value[id] = null;
                                if (opponent === 1) p1OnBoard.value--; else p2OnBoard.value--;
                                finalizeTurn();
                            }
                        }
                        return;
                    }

                    if (phase.value === 'placing') {
                        if (!cell) {
                            board.value[id] = turn.value;
                            if (turn.value === 1) { p1Stock.value--; p1OnBoard.value++; }
                            else { p2Stock.value--; p2OnBoard.value++; }

                            if (isPartOfMill(id, turn.value)) phase.value = 'removing';
                            else finalizeTurn();
                        }
                    } else if (phase.value === 'moving') {
                        if (cell === turn.value) {
                            selectedPoint.value = id;
                        } else if (selectedPoint.value !== null && !cell) {
                            const count = turn.value === 1 ? p1OnBoard.value : p2OnBoard.value;
                            if (count === 3 || adjacencies[selectedPoint.value].includes(id)) {
                                board.value[selectedPoint.value] = null;
                                board.value[id] = turn.value;
                                selectedPoint.value = null;
                                if (isPartOfMill(id, turn.value)) phase.value = 'removing';
                                else finalizeTurn();
                            }
                        }
                    }
                };

                const finalizeTurn = () => {
                    if (p1Stock.value === 0 && p2Stock.value === 0) phase.value = 'moving';
                    else phase.value = 'placing';

                    turn.value = turn.value === 1 ? 2 : 1;
                    checkWinConditions();
                };

                const checkWinConditions = () => {
                    // 1. Piece Count Condition
                    if (p1Stock.value === 0 && p1OnBoard.value < 3) winner.value = 2;
                    else if (p2Stock.value === 0 && p2OnBoard.value < 3) winner.value = 1;

                    // 2. Trapped Condition (Only applies in Moving phase)
                    if (!winner.value && phase.value === 'moving') {
                        if (!canMove(turn.value)) {
                            winner.value = turn.value === 1 ? 2 : 1;
                        }
                    }
                };

                const resetGame = () => {
                    board.value = Array(24).fill(null);
                    turn.value = 1;
                    phase.value = 'placing';
                    p1Stock.value = 9;
                    p2Stock.value = 9;
                    p1OnBoard.value = 0;
                    p2OnBoard.value = 0;
                    selectedPoint.value = null;
                    winner.value = null;
                };

                return { points, board, turn, phase, p1Stock, p2Stock, p1OnBoard, p2OnBoard, selectedPoint, statusMessage, handleClick, winner, resetGame };
            }
        }).mount('#app');
    </script>
</body>
</html>

